## 目錄
* [目錄](#目錄)
* [基本說明](#基本說明)
* [SUSE 15 安裝示範](#SUSE-15-安裝示範)
* [網路設定](#網路設定)
* [NFS](#NFS)
* [NIS](#NIS)
* [NTP/chrony](#NTP/chrony)
* [Virtual Machine Manager安裝方法及設定](#Virtual-Machine-Manager安裝方法及設定)
   * [brctl](#brctl)

---
## 基本說明
1. 主要紀錄本次架設時進行的設定操作，其餘較詳細的部分可以參考先前筆記
2. 


---
## SLES 15 安裝過程示範
0. 較為詳細的安裝過程請參考>>>[02. SUSE 15 Install.md](https://github.com/HongScarlet/homework/blob/master/SUSE15%20cluster/02.%20SUSE%2015%20Install.md) 
1. bios 關掉 Hyper Threading

2. 硬碟分割參考
```bash
# xeon
sda
├─sda1  512MB  /boot
├─sda2  192GB  [SWAP]
├─sda3   30GB  /
├─sda4     1K  
├─sda5   30GB  /usr
└─sda6  other  /tmp
```
```bash
# gpu (做lvm)
sda
├─sda1         512MB  /boot
└─sda2
  ├─vg00-lv00    2GB  [SWAP]
  └─vg00-lv01  256GB  /
```

---
## 網路設定

---
## NFS
server
```bash
server :~ # yast
Network Services > NFS Server
# Enter NFSv4 domain name

Host Wild Card  Options
192.168.1.0/24  rw,no_root_squash,async,no_subtree_check
client :~ # mkdir work1 work2
client :~ # yast
```

client
```bash
# 掛載 work1 work2 home
client :~ # mkdir work1 work2
client :~ # yast
Network Services > NFS Client

# 掛載repo
client :~ # zypper rr -a
client :~ # cd /work1/pkg/sle15sp2_repo/
client :~ # ls -d {M,P}* | xargs -i zypper ar {} {}
client :~ # zypper ref
client :~ # zypper lr
```

---
## NIS
server
```bash
server :~ # yast
Network Services > NIS Server

# NIS Domain Name
# Slave

Netmask        Network 
255.0.0.0      127.0.0.0  
255.255.255.0  192.168.1.0 

server :~ # systemctl enable ypserv
server :~ # systemctl start ypserv
server :~ # systemctl status ypserv
server :~ # ps aux | grep ypserv
```

client
```bash
client :~ # yast
Network Services > NIS Client
# NIS Domain
# Addresses of NIS servers

client :~ # systemctl enable ypbind
client :~ # systemctl start ypbind
client :~ # systemctl status ypbind
client :~ # ps aux | grep ypbind
```

test
```bash
server :~ # useradd test1
server :~ # getent passwd
test1:x:1001:100::......
client :~ # getent passwd
(找不到test1)

● yast > Network Services > NIS server
● 原因： 當server創建新user時,ypserv的資料沒有被更新,導致ypbind拿過去的資料沒有新user
● 因此直接重啟 ypserv 的服務是沒有用的
● yast > NIS server 完成設定後的第一步為 Remove /var/yp/jjc (移除舊的檔案後續在創建新的)

server:~ # cd /var/yp; make
```

```bash
client :~ # getent passwd
client :~ # id test1
(getent passwd 有抓到使用者，但id沒有)

client :~ # reboot
```

---
## NTP/chrony
```bash
clien :~ # vi /etc/chrony.conf
server <server ip>
client :~ # systemctl enable chronyd
client :~ # systemctl start chronyd
client :~ # chronyc sources
client :~ # chronyc burst 4/4
client :~ # chronyc makestep

# check
server :~ # date
client :~ # date
```

---
## munge
server
```bash
server :~ # zypper in munge
server :~ # systemctl enable munge
server :~ # systemctl start munge
```
client
```bash
server :~ # zypper in munge
server :~ # systemctl enable munge
server :~ # systemctl start munge
```
munge.key
```bash
server :~ # scp /etc/munge/munge.key root@<client>:/etc/munge/.
server :~ # md5sum /etc/munge/munge.key
client :~ # md5sum /etc/munge/munge.key
```
check
```bash
server :~ # munge -n
server :~ # munge -n | unmunge
server :~ # munge -n | ssh <client> unmunge

client :~ # munge -n
client :~ # munge -n | unmunge
client :~ # munge -n | ssh <server> unmunge
```

```
xeon > /boot :512MB   SWAP: 192G   /:30G  /usr : 30G  /tmp: all
Gpu: /boot:512MB  SWAP:2G   /:256G   (要做lvm)
# 安裝過程會經歷以下7個步驟(主要重點在5)
You will complete the following steps:
   1.  Welcome
   2.  End User License Agreement
   3.  Intel® Software Improvement Program
   4.  License Activation
   5.  Configuration
   6.  Installation
   7.  Installation Complete

--------------------------------------------------------------------------------
Press "Enter" key to continue or "q" to quit:
```
